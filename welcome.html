<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Index of Dissent â€” All objects</title>
  <link rel="stylesheet" href="style.css?v=2" />
  <style>
    /* Minimal, focused gallery layout */
    :root{--site-gutter:24px}
    html,body{height:100%;margin:0}
    main{min-height:100vh;padding:var(--site-gutter);box-sizing:border-box}
    #infinite-gallery{
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(200px,1fr));
      gap:16px;
      align-items:start;
      max-width:1400px;
      margin:0 auto;
    }
    .card-link{display:block;color:inherit;text-decoration:none}
    .card{background:#fff;overflow:hidden;display:block;position:relative;border:0}
    .card img{width:100%;height:260px;object-fit:cover;display:block;background:#f4f4f4}
  .lazy-img{opacity:0;transition:opacity .28s ease}
  .lazy-img.img-loaded{opacity:1}
  /* top and bottom sentinels used to detect scroll edges */
  #gallery-sentinel, #gallery-sentinel-top{height:1px;pointer-events:none}
    @media (max-width:520px){ .card img{height:160px} }
    /* Controls bar and list view styles. The controls bar is hidden by default
       and is shown when the Search toggle is activated. */
    .controls-bar{
      display:none; /* hidden until Search is pressed */
      gap:12px;align-items:center;flex-wrap:wrap;justify-content:flex-start;padding:10px;border-radius:8px;background:#fff;box-shadow:0 8px 24px rgba(0,0,0,0.12);width:320px;box-sizing:border-box}
    .controls-bar.visible{display:flex;flex-direction:column}
    .view-toggle{display:inline-flex;border:1px solid rgba(0,0,0,0.08);border-radius:6px;overflow:hidden}
    .view-toggle button{all:unset;padding:8px 12px;cursor:pointer;font-weight:600}
    .view-toggle button[aria-pressed="true"]{background:#000;color:#fff}
    .controls-inputs{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .controls-inputs input[type="search"],.controls-inputs select{padding:8px 10px;border-radius:6px;border:1px solid rgba(0,0,0,0.08);font-size:15px}
    #list-view{max-width:1400px;margin:0 auto;display:none;padding:0  var(--site-gutter);box-sizing:border-box}
    .list-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
  /* List view: tags-only rows (no photos). */
  #list-grid{display:block}
  .list-row{background:#fff;padding:10px 14px;border-radius:8px;margin-bottom:10px;box-shadow:0 6px 14px rgba(0,0,0,0.06);display:block;text-decoration:none;color:inherit}
  .list-row h3{margin:0 0 6px 0;font-size:18px}
  .list-row .tags{margin-top:6px}
  .list-card{display:none}
    @media (max-width:520px){ .list-card img{height:120px} }
   /* Tag chips for list view: four kinds with distinct colors */
  .tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
  .tag{display:inline-block;padding:4px 8px;border-radius:5px;font-size:22px;color:#000000}
  .tag.name{background:#f8f162}    /* blue */
  .tag.country{background:#b4d32b} /* green */
  .tag.type{background:#f76f54}    /* orange */
  .tag.cause{background:#fbb28b}   /* red */
  .tag.clickable-tag{cursor:pointer;opacity:0.95}
  .tag.clickable-tag:hover{filter:brightness(0.95);transform:translateY(-1px)}
  .tag.active{box-shadow:0 0 0 3px rgba(0,0,0,0.06) inset}
  /* List controls: search + kind toggles (appears at top of #list-view) */
  #list-controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
  #list-controls .list-search{flex:1;min-width:160px;padding:8px 10px;border-radius:6px;border:1px solid rgba(0,0,0,0.08);font-size:15px}
  .tag-toggles{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  /* Make the tag-toggle labels minimal (no background or border). The checkbox
     itself becomes the visible affordance: a black square with a white check when
     checked. */
  .tag-toggle{display:inline-flex;align-items:center;gap:8px;background:transparent;padding:6px 10px;border-radius:999px;border:0;cursor:pointer;font-size:13px;color:#000}
  /* Keep the active state minimal too: transparent background and black text */
  .tag-toggle.active{background:transparent;color:#000;border-color:transparent;box-shadow:none}
  .tag-toggle input{
    -webkit-appearance:none;appearance:none;
    display:inline-block;width:18px;height:18px;margin-right:8px;vertical-align:middle;cursor:pointer;border-radius:4px;border:0;background:transparent;box-shadow:none;
    background-repeat:no-repeat;background-position:center;background-size:12px;
  }
  /* When checked, render a solid black box with a white checkmark (inline SVG). */
  .tag-toggle input:checked{
    
    background-image:url("data:image/svg+xml;utf8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2024%2024%22%3E%3Cpath%20fill=%22%23fff%22%20d=%22M20.285%206.708l-11.39%2011.39-5.18-5.18%201.414-1.414%203.766%203.766%209.976-9.976z%22/%3E%3C/svg%3E");
  }
  /* keyboard focus visible state */
  .tag-toggle input:focus{outline:2px solid rgba(0,0,0,0.12);outline-offset:2px}
  .tag-toggle.active{background:#000;color:#fff;border-color:transparent}
  /* Photo results grid used when a tag is clicked */
  .photo-results-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}
  .photo-result img{width:100%;height:140px;object-fit:cover;border-radius:6px;display:block}
  @media (max-width:520px){ .photo-result img{height:110px} }
    
  </style>
</head>
<body>
  <div class="site-brand">Index of<br>Dissent</div>
  <style>
    /* Site brand fixed top-left with no background; per-letter overlap effect */
    .site-brand{
      position:fixed;
      left:18px;
      top:12px;
      z-index:2200;
      font-family: 'Blur Light', 'Blur Regular', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size:50px;
      line-height:0.9;
      padding:6px 0; /* no background, keep small padding */
      color:#000;
      transition: color .12s ease, transform .12s ease;
      pointer-events: none; /* allow clicks to pass through to gallery */
      white-space: pre-line;
    }
    /* When the site is in 'list view' we want the brand to participate in normal
       document flow so the list can sit below it. Toggle a class on <body>
       (see js/welcome.js) and this rule will switch the brand to static
       positioning so it occupies space above the list. */
    body.list-view .site-brand{
      position:static;
      left:auto; top:auto;
      z-index: auto;
      pointer-events: auto;
      display:block;
      margin-bottom: 12px;
      /* align with main content padding / search box which uses --site-gutter */
      margin-left: var(--site-gutter);
      /* ensure it doesn't overflow on very narrow screens */
      max-width: calc(100% - (var(--site-gutter) * 1));
      transform: none;
    }
    /* Individual character spans so we can toggle color per-letter */
  .site-brand .brand-char{ display:inline-block; will-change:transform,color,opacity; transition: color .08s ease, transform .08s cubic-bezier(.2,.8,.2,1), opacity .08s ease; color: #000; transform: translateZ(0); }
  .site-brand .brand-char.overlap{ color: #fff; text-shadow: 0 0 6px rgba(0,0,0,0.45); transform: translateY(-2px) scale(1.02); opacity: 0.98; }
    /* smaller on small screens */
    @media (max-width:520px){ .site-brand{ font-size:36px; left:12px; top:8px; } }
  </style>
  <main>
    <!-- Controls: view toggle, search, filters -->
    <div class="controls-bar" role="region" aria-label="View and filter controls">
      <div class="view-toggle" role="tablist" aria-label="View toggle">
        <button id="btn-gallery" aria-pressed="true" type="button">Gallery</button>
        <button id="btn-list" aria-pressed="false" type="button">List</button>
      </div>
      <div class="controls-inputs">
        <label for="search-input" class="sr-only">Search</label>
        <input id="search-input" type="search" placeholder="Search by name or description" aria-label="Search" />
        <select id="filter-type" aria-label="Filter by type"><option value="">Type (all)</option></select>
        <select id="filter-country" aria-label="Filter by country"><option value="">Country (all)</option></select>
        <select id="filter-cause" aria-label="Filter by cause"><option value="">Cause (all)</option></select>
      </div>
    </div>

  <div id="gallery-sentinel-top" aria-hidden="true"></div>
  <section id="infinite-gallery" aria-label="All objects gallery"></section>
  <div id="gallery-sentinel" aria-hidden="true"></div>
    <!-- List view (hidden by default) -->
    <section id="list-view" aria-label="List of objects">
      <!-- list-level filters: search tags and toggle kinds -->
      <div id="list-controls" aria-hidden="false">
        <input id="list-search" class="list-search" type="search" placeholder="Search tags..." aria-label="Search tags" />
        <div class="tag-toggles" role="toolbar" aria-label="Tag kinds">
          <label class="tag-toggle active" data-kind="name"><input type="checkbox" data-kind="name" checked />Names</label>
          <label class="tag-toggle active" data-kind="country"><input type="checkbox" data-kind="country" checked />Countries</label>
          <label class="tag-toggle active" data-kind="type"><input type="checkbox" data-kind="type" checked />Types</label>
          <label class="tag-toggle active" data-kind="cause"><input type="checkbox" data-kind="cause" checked />Causes</label>
        </div>
      </div>
      <div id="list-count" style="margin:8px 0;color:#333"></div>
      <div id="list-grid" class="list-grid"></div>
    </section>
    <noscript>
      <p>Please enable JavaScript to view the gallery.</p>
    </noscript>
  </main>

  <!-- Floating toggle in bottom-right: Explore / List / Search -->
  <div id="floating-toggle" style="position:fixed;right:14px;bottom:14px;z-index:1500;">
    <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end;">
      <button id="btn-gallery-float" aria-label="Explore (gallery)" title="Explore" style="all:unset;background:#fff;padding:10px 12px;border-radius:999px;box-shadow:0 6px 18px rgba(0,0,0,0.12);cursor:pointer">Explore</button>
      <button id="btn-list-float" aria-label="List view" title="List" style="all:unset;background:#fff;padding:10px 12px;border-radius:999px;box-shadow:0 6px 18px rgba(0,0,0,0.12);cursor:pointer">List</button>
      <button id="btn-search-float" aria-label="Search" title="Search" style="all:unset;background:#000;color:#fff;padding:10px 12px;border-radius:999px;box-shadow:0 6px 18px rgba(0,0,0,0.12);cursor:pointer">Search</button>
    </div>
  </div>
  <script src="js/infinite-gallery.js"></script>
  <script src="js/welcome.js"></script>
  <script>
  (function(){
    const brand = document.querySelector('.site-brand');
    if(!brand) return;

    // Split brand text into per-character spans (preserve <br> nodes)
    function splitBrandChars(el){
      const nodes = Array.from(el.childNodes);
      el.innerHTML = '';
      nodes.forEach(n => {
        if(n.nodeType === Node.ELEMENT_NODE && n.tagName === 'BR'){
          el.appendChild(document.createElement('br'));
          return;
        }
        const text = n.textContent || '';
        for(let ch of text){
          const span = document.createElement('span');
          span.className = 'brand-char';
          // convert plain spaces to non-breaking spaces so they keep a visible gap
          // when each character is wrapped in inline-block spans.
          if (ch === ' ') span.textContent = '\u00A0'; else span.textContent = ch;
          el.appendChild(span);
        }
      });
    }

    splitBrandChars(brand);

    const chars = Array.from(brand.querySelectorAll('.brand-char'));
    const imageSelectors = '#infinite-gallery img, #infinite-gallery .card';

    function rectsOverlap(a,b){ return !(b.left > a.right || b.right < a.left || b.top > a.bottom || b.bottom < a.top); }

    function checkOverlap(){
      try{
        const imgs = Array.from(document.querySelectorAll(imageSelectors));
        // filter to visible images to speed up check
        const visibleImgs = imgs.filter(img => {
          const r = img.getBoundingClientRect();
          return !(r.bottom < 0 || r.top > (window.innerHeight||document.documentElement.clientHeight));
        }).map(i=>i.getBoundingClientRect());

        if(visibleImgs.length === 0){
          // no images in viewport -> ensure chars are in default state
          chars.forEach(c => c.classList.remove('overlap'));
          return;
        }

        chars.forEach(c => {
          const r = c.getBoundingClientRect();
          let overlapped = false;
          for(let im of visibleImgs){ if(rectsOverlap(r, im)){ overlapped = true; break; } }
          c.classList.toggle('overlap', overlapped);
        });
      }catch(e){ console.warn('brand overlap check failed', e); }
    }

  // use requestAnimationFrame to schedule checks for smoother, immediate response
  let scheduled = false;
  function scheduleCheck(){ if(scheduled) return; scheduled = true; requestAnimationFrame(()=>{ scheduled = false; checkOverlap(); }); }
  ['scroll','resize','load','orientationchange'].forEach(ev => window.addEventListener(ev, scheduleCheck, {passive:true}));
  document.addEventListener('DOMContentLoaded', scheduleCheck);
  const gallery = document.getElementById('infinite-gallery');
  if(gallery){ const mo = new MutationObserver(scheduleCheck); mo.observe(gallery, { childList:true, subtree:true, attributes:true }); }
  // run once after layout
  requestAnimationFrame(checkOverlap);
  })();
  </script>
</body>
</html>
